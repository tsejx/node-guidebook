(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{210:function(t,s,a){t.exports=a.p+"assets/img/cluster-run-flow.3b2ba1e8.png"},256:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"é›†ç¾¤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#é›†ç¾¤"}},[t._v("#")]),t._v(" é›†ç¾¤")]),t._v(" "),n("p",[t._v("Node å®ä¾‹æ˜¯å•çº¿ç¨‹ä½œä¸šçš„ã€‚åœ¨æœåŠ¡ç«¯ç¼–ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šåˆ›å»ºå¤šä¸ª Node å®ä¾‹æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä»¥æ­¤æå‡ç³»ç»Ÿçš„ååç‡ã€‚å¯¹è¿™æ ·å¤šä¸ª Node å®ä¾‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º clusterï¼ˆé›†ç¾¤ï¼‰ã€‚")]),t._v(" "),n("p",[t._v("å€ŸåŠ© Node.js çš„ cluster æ¨¡å—ï¼Œå¼€å‘è€…å¯ä»¥åœ¨å‡ ä¹ä¸ä¿®æ”¹åŸæœ‰é¡¹ç›®ä»£ç çš„å‰æä¸‹ï¼Œè·å¾—é›†ç¾¤æœåŠ¡å¸¦æ¥çš„å¥½å¤„ã€‚")]),t._v(" "),n("p",[t._v("é›†ç¾¤æœ‰ä»¥ä¸‹ä¸¤ç§å¸¸è§çš„å®ç°æ–¹æ¡ˆï¼š")]),t._v(" "),n("p",[n("strong",[t._v("æ–¹æ¡ˆä¸€ï¼šå¤šä¸ª Node å®ä¾‹+å¤šä¸ªç«¯å£")])]),t._v(" "),n("p",[t._v("é›†ç¾¤å†…çš„ Node.js å®ä¾‹ï¼Œå„è‡ªç›‘å¬ä¸åŒçš„ç«¯å£ï¼Œå†ç”±åå‘ä»£ç†å®æ–½è¯·æ±‚åˆ°å¤šä¸ªç«¯å£çš„åˆ†å‘ã€‚")]),t._v(" "),n("ul",[n("li",[t._v("ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œå„å®ä¾‹ç›¸å¯¹ç‹¬ç«‹ï¼Œè¿™å¯¹æœåŠ¡ç¨³å®šæ€§æœ‰å¥½å¤„")]),t._v(" "),n("li",[t._v("ç¼ºç‚¹ï¼šå¢åŠ ç«¯å£å ç”¨ï¼Œè¿›ç¨‹ä¹‹é—´é€šä¿¡æ¯”è¾ƒéº»çƒ¦")])]),t._v(" "),n("p",[n("strong",[t._v("æ–¹æ¡ˆäºŒï¼šä¸»è¿›ç¨‹å‘å­è¿›ç¨‹è½¬å‘è¯·æ±‚")])]),t._v(" "),n("p",[t._v("é›†ç¾¤å†…ï¼Œåˆ›å»ºä¸€ä¸ªä¸»è¿›ç¨‹ï¼ˆmasterï¼‰ï¼Œä»¥åŠè‹¥å¹²ä¸ªå­è¿›ç¨‹ï¼ˆworkerï¼‰ã€‚ç”± master ç›‘å¬å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ï¼Œå¹¶æ ¹æ®ç‰¹å®šçš„ç­–ç•¥ï¼Œè½¬å‘è‡³å¯¹åº”çš„ workerã€‚è€Œè¿™ç§æ–¹æ¡ˆä¸º Node.js çš„ cluster æ¨¡å¼æ‰€ä½¿ç”¨ã€‚")]),t._v(" "),n("ul",[n("li",[t._v("ä¼˜ç‚¹ï¼šé€šå¸¸åªå ç”¨ä¸€ä¸ªç«¯å£ï¼Œé€šä¿¡ç›¸å¯¹ç®€å•ï¼Œè½¬å‘ç­–ç•¥æ›´çµæ´»")]),t._v(" "),n("li",[t._v("ç¼ºç‚¹ï¼šå®ç°ç›¸å¯¹å¤æ‚ï¼Œå¯¹ä¸»è¿›ç¨‹çš„ç¨³å®šæ€§è¦æ±‚è¾ƒé«˜")])]),t._v(" "),n("h2",{attrs:{id:"é›†ç¾¤åˆ›å»º"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#é›†ç¾¤åˆ›å»º"}},[t._v("#")]),t._v(" é›†ç¾¤åˆ›å»º")]),t._v(" "),n("p",[t._v("Cluster æ˜¯å¸¸è§çš„ Node.js åˆ©ç”¨å¤šæ ¸çš„æ–¹æ³•ï¼Œå®ƒæ˜¯åŸºäº "),n("code",[t._v("child_process.fork()")]),t._v(" å®ç°çš„ï¼Œæ‰€ä»¥ cluster äº§ç”Ÿçš„è¿›ç¨‹ä¹‹é—´æ˜¯é€šè¿‡ "),n("router-link",{attrs:{to:"/process/ipc.html"}},[t._v("IPC")]),t._v(" æ¥é€šä¿¡çš„ï¼Œå¹¶ä¸”å®ƒä¹Ÿæ²¡æœ‰æ‹·è´çˆ¶è¿›ç¨‹çš„ç©ºé—´ï¼Œè€Œæ˜¯é€šè¿‡åŠ å…¥ "),n("code",[t._v("cluster.isMaster")]),t._v(" è¿™ä¸ªæ ‡è¯†ï¼Œæ¥åŒºåˆ†çˆ¶è¿›ç¨‹ä»¥åŠå­è¿›ç¨‹ï¼Œè¾¾åˆ°ç±»ä¼¼ POSIX çš„ fork çš„æ•ˆæœã€‚")],1),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cluster "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cluster'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// | |")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// | |")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" numCPUs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'os'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cpus")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// | |    éƒ½æ‰§è¡Œäº†")]),t._v("\n                                               "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// | |")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isMaster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("                        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// |-|-----------------")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Fork workers.                             //   |")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" numCPUs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   |")]),t._v("\n    cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   |")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("                                            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   | ä»…çˆ¶è¿›ç¨‹æ‰§è¡Œ (master.js)")]),t._v("\n  cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'exit'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("worker")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("             "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   |")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("worker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pid"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(" died")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   |")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                                          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   |")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("                                       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// |-------------------")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Workers can share any TCP connection      // |")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// In this case it is an HTTP server         // |")]),t._v("\n  http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("reqï¼Œres")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// |")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// |   ä»…å­è¿›ç¨‹æ‰§è¡Œ (worker.js)")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello world!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// |")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                             "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// |")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("                                              "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// |-------------------")]),t._v("\n                                               "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// | |")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello world!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// | |    éƒ½æ‰§è¡Œäº†")]),t._v("\n")])])]),n("p",[t._v("åœ¨ä¸Šè¿°ä»£ç ä¸­ "),n("code",[t._v("numCPUs")]),t._v(" è™½ç„¶æ˜¯å…¨å±€å˜é‡ä½†æ˜¯ï¼Œåœ¨çˆ¶è¿›ç¨‹ä¸­ä¿®æ”¹å®ƒï¼Œå­è¿›ç¨‹ä¸­å¹¶ä¸ä¼šæ”¹å˜ï¼Œå› ä¸ºçˆ¶è¿›ç¨‹ä¸å­è¿›ç¨‹æ˜¯å®Œå…¨ç‹¬ç«‹çš„ä¸¤ä¸ªç©ºé—´ã€‚ä»–ä»¬æ‰€è°“çš„å…±æœ‰ä»…ä»…åªæ˜¯éƒ½æ‰§è¡Œäº†ï¼Œå¹¶ä¸æ˜¯åŒä¸€ä»½ã€‚")]),t._v(" "),n("p",[t._v("ä½ å¯ä»¥æŠŠçˆ¶è¿›ç¨‹æ‰§è¡Œçš„éƒ¨åˆ†å½“åš "),n("code",[t._v("master.js")]),t._v("ï¼Œå­è¿›ç¨‹æ‰§è¡Œçš„éƒ¨åˆ†å½“åš "),n("code",[t._v("worker.js")]),t._v("ï¼Œä½ å¯ä»¥æŠŠä»–ä»¬æƒ³è±¡æˆæ˜¯å…ˆæ‰§è¡Œäº† "),n("code",[t._v("node master.js")]),t._v(" ç„¶å "),n("code",[t._v("cluster.fork")]),t._v(" äº†å‡ æ¬¡ï¼Œå°±æ‰§è¡Œäº†å‡ æ¬¡ "),n("code",[t._v("node worker.js")]),t._v("ã€‚è€Œ cluster æ¨¡å—åˆ™æ˜¯äºŒè€…ä¹‹é—´çš„ä¸€ä¸ªæ¡¥æ¢ï¼Œä½ å¯ä»¥é€šè¿‡ cluster æä¾›çš„æ–¹æ³•ï¼Œè®©å…¶äºŒè€…ä¹‹é—´è¿›è¡Œæ²Ÿé€šäº¤æµã€‚")]),t._v(" "),n("h2",{attrs:{id:"è¿ä½œåŸç†"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#è¿ä½œåŸç†"}},[t._v("#")]),t._v(" è¿ä½œåŸç†")]),t._v(" "),n("p",[t._v("äº†è§£ cluster æ¨¡å—ï¼Œä¸»è¦éœ€è¦ææ¸…æ¥šä¸‰ä¸ªé—®é¢˜ï¼š")]),t._v(" "),n("ol",[n("li",[t._v("master å’Œ worker å¦‚ä½•é€šä¿¡ï¼Ÿ")]),t._v(" "),n("li",[t._v("å¤šä¸ª server å®ä¾‹ï¼Œå¦‚ä½•å®ç°ç«¯å£å…±äº«ï¼Ÿ")]),t._v(" "),n("li",[t._v("å¤šä¸ª server å®ä¾‹ï¼Œæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚å¦‚ä½•åˆ†å‘åˆ°å¤šä¸ª workerï¼Ÿ")])]),t._v(" "),n("h3",{attrs:{id:"è¿›ç¨‹é—´é€šä¿¡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#è¿›ç¨‹é—´é€šä¿¡"}},[t._v("#")]),t._v(" è¿›ç¨‹é—´é€šä¿¡")]),t._v(" "),n("blockquote",[n("p",[t._v("master å’Œ worker å¦‚ä½•é€šä¿¡ï¼Ÿ")])]),t._v(" "),n("p",[t._v("master è¿›ç¨‹é€šè¿‡ "),n("code",[t._v("cluster.fork()")]),t._v(" æ¥åˆ›å»º worker è¿›ç¨‹ã€‚"),n("code",[t._v("cluster.fork()")]),t._v(" å†…éƒ¨æ˜¯é€šè¿‡"),n("code",[t._v("child_process.fork()")]),t._v(" æ–¹æ³•åˆ›å»ºçš„ã€‚")]),t._v(" "),n("p",[t._v("ä¹Ÿå°±æ˜¯è¯´ï¼š")]),t._v(" "),n("ol",[n("li",[t._v("master è¿›ç¨‹å’Œ worker è¿›ç¨‹æ˜¯çˆ¶å­è¿›ç¨‹çš„å…³ç³»")]),t._v(" "),n("li",[t._v("master è¿›ç¨‹å’Œ worker è¿›ç¨‹å¯ä»¥é€šè¿‡ IPC é€šé“è¿›è¡Œé€šä¿¡ç›¸äº’ä¼ é€’æœåŠ¡å¥æŸ„ ğŸ“Œ")])]),t._v(" "),n("h3",{attrs:{id:"ç«¯å£å…±äº«"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ç«¯å£å…±äº«"}},[t._v("#")]),t._v(" ç«¯å£å…±äº«")]),t._v(" "),n("blockquote",[n("p",[t._v("å¤šä¸ª server å®ä¾‹ï¼Œå¦‚ä½•å®ç°ç«¯å£å…±äº«ï¼Ÿ")])]),t._v(" "),n("p",[t._v("åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œå¤šä¸ª worker ä¸­åˆ›å»ºçš„ server ç›‘å¬äº†ç›¸åŒçš„ç«¯å£ 3000ã€‚é€šå¸¸æ¥è¯´ï¼Œå¤šä¸ªè¿›ç¨‹ç›‘å¬åŒä¸ªç«¯å£ï¼Œç³»ç»Ÿä¼šæŠ¥é”™ã€‚")]),t._v(" "),n("p",[t._v("é‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬çš„ç¤ºä¾‹æ²¡é—®é¢˜å‘¢ï¼Ÿ")]),t._v(" "),n("p",[t._v("è¿™æ˜¯å› ä¸ºåœ¨ net æ¨¡å—ä¸­ï¼Œä¼šæ ¹æ®å½“å‰è¿›ç¨‹æ˜¯ master è¿›ç¨‹è¿˜æ˜¯ worker è¿›ç¨‹ï¼Œå¯¹ "),n("code",[t._v("listen()")]),t._v(" æ–¹æ³•è¿›è¡Œäº†ç‰¹æ®Šå¤„ç†ï¼š")]),t._v(" "),n("ol",[n("li",[t._v("master è¿›ç¨‹ï¼šåœ¨è¯¥ç«¯å£ä¸Šæ­£å¸¸ç›‘å¬è¯·æ±‚ï¼ˆæ²¡åšç‰¹æ®Šå¤„ç†ï¼‰")]),t._v(" "),n("li",[t._v("worker è¿›ç¨‹ï¼šåˆ›å»º Server å®ä¾‹ã€‚ç„¶åé€šè¿‡ IPC é€šé“ï¼Œå‘ master è¿›ç¨‹å‘é€æ¶ˆæ¯ï¼Œè®© master è¿›ç¨‹é¡µåˆ›å»º server å®ä¾‹ï¼Œå¹¶åœ¨è¯¥ç«¯å£ä¸Šç›‘å¬è¯·æ±‚ã€‚å½“è¯·æ±‚è¿›æ¥æ—¶ï¼Œmaster è¿›ç¨‹å°†è¯·æ±‚è½¬å‘ç»™ worker è¿›ç¨‹çš„ server å®ä¾‹ã€‚")])]),t._v(" "),n("p",[t._v("å½’çº³èµ·æ¥ï¼Œå°±æ˜¯ï¼šmaster è¿›ç¨‹ç›‘å¬ç‰¹å®šç«¯å£ï¼Œå¹¶å°†å®¢æˆ·è¯·æ±‚è½¬å‘ç»™ worker è¿›ç¨‹ã€‚")]),t._v(" "),n("p",[n("img",{attrs:{src:a(210),alt:"Clusteræ¨¡å—è¿è¡Œæµç¨‹"}})]),t._v(" "),n("h3",{attrs:{id:"åˆ†å‘è¿æ¥"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†å‘è¿æ¥"}},[t._v("#")]),t._v(" åˆ†å‘è¿æ¥")]),t._v(" "),n("blockquote",[n("p",[t._v("å¤šä¸ª server å®ä¾‹ï¼Œæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚å¦‚ä½•åˆ†å‘åˆ°å¤šä¸ª workerï¼Ÿ")])]),t._v(" "),n("p",[t._v("æ¯å½“ worker è¿›ç¨‹åˆ›å»º server å®ä¾‹æ¥ç›‘å¬è¯·æ±‚ï¼Œéƒ½ä¼šé€šè¿‡ IPC é€šé“ï¼Œåœ¨ master ä¸Šè¿›è¡Œæ³¨å†Œã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾ï¼Œmaster ä¼šè´Ÿè´£å°†è¯·æ±‚è½¬å‘ç»™å¯¹åº”çš„ workerã€‚")]),t._v(" "),n("p",[t._v("å…·ä½“è½¬å‘ç»™å“ªä¸ª workerï¼Ÿè¿™æ˜¯ç”±è½¬å‘ç­–ç•¥å†³å®šçš„ã€‚å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ "),n("code",[t._v("NODE_CLUSTER_SCHED_POLICY")]),t._v(" è®¾ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨ "),n("code",[t._v("cluster.setupMaster(options)")]),t._v(" æ—¶ä¼ å…¥ã€‚")]),t._v(" "),n("p",[t._v("cluster æ¨¡å—æä¾›äº†ä¸¤ç§åˆ†å‘è¿æ¥çš„æ–¹å¼ã€‚")]),t._v(" "),n("p",[t._v("ç¬¬ä¸€ç§æ–¹å¼ (é»˜è®¤æ–¹å¼ï¼Œä¸é€‚ç”¨äº Windows)ï¼Œé€šè¿‡"),n("strong",[t._v("æ—¶é—´ç‰‡è½®è½¬æ³•")]),t._v("ï¼ˆround-robinï¼‰åˆ†å‘è¿æ¥ã€‚ä¸»è¿›ç¨‹ç›‘å¬ç«¯å£ï¼Œæ¥æ”¶åˆ°æ–°è¿æ¥ä¹‹åï¼Œé€šè¿‡æ—¶é—´ç‰‡è½®è½¬æ³•æ¥å†³å®šå°†æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯çš„ Socket å¥æŸ„ä¼ é€’ç»™æŒ‡å®šçš„ worker å¤„ç†ã€‚è‡³äºæ¯ä¸ªè¿æ¥ç”±å“ªä¸ª worker æ¥å¤„ç†ï¼Œå®Œå…¨ç”±å†…ç½®çš„å¾ªç¯ç®—æ³•å†³å®šã€‚")]),t._v(" "),n("p",[t._v("ç¬¬äºŒç§æ–¹å¼æ˜¯ç”±ä¸»è¿›ç¨‹åˆ›å»º socket ç›‘å¬ç«¯å£åï¼Œå°† socket å¥æŸ„ç›´æ¥åˆ†å‘ç»™ç›¸åº”çš„ workerï¼Œç„¶åå½“è¿æ¥è¿›æ¥æ—¶ï¼Œå°±ç›´æ¥ç”±ç›¸åº”çš„ worker æ¥æ¥æ”¶è¿æ¥å¹¶å¤„ç†ã€‚")]),t._v(" "),n("p",[t._v("ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼æ—¶ç†è®ºä¸Šæ€§èƒ½åº”è¯¥è¾ƒé«˜ï¼Œç„¶è€Œæ—¶é—´ä¸Šå­˜åœ¨è´Ÿè½½ä¸å‡è¡¡çš„é—®é¢˜ï¼Œæ¯”å¦‚é€šå¸¸ 70% çš„è¿æ¥ä»…è¢« 8 ä¸ªè¿›ç¨‹ä¸­çš„ 2 ä¸ªå¤„ç†ï¼Œè€Œå…¶ä»–è¿›ç¨‹æ¯”è¾ƒæ¸…é—²ã€‚")]),t._v(" "),n("h2",{attrs:{id:"é›†ç¾¤çš„å¯ä¼¸ç¼©æ€§ç­–ç•¥"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#é›†ç¾¤çš„å¯ä¼¸ç¼©æ€§ç­–ç•¥"}},[t._v("#")]),t._v(" é›†ç¾¤çš„å¯ä¼¸ç¼©æ€§ç­–ç•¥")]),t._v(" "),n("p",[t._v("Node.js ä¸­çš„ä¼¸ç¼©æ€§æ˜¯èåˆåˆ°è¿è¡Œæ—¶æ ¸å¿ƒçš„ç‰¹æ€§ã€‚Node è¢«å‘½åä¸º Node æ˜¯ä¸ºäº†å¼ºè°ƒ Node åº”ç”¨åº”è¯¥åŒ…å«å¤šä¸ªç›¸äº’ä¹‹é—´é€šä¿¡çš„å°å‹åˆ†å¸ƒå¼èŠ‚ç‚¹ã€‚")]),t._v(" "),n("p",[t._v("Node.js çš„ cluster æ¨¡å—ä¸ä»…æä¾›äº†å……åˆ†åˆ©ç”¨æœºå™¨ CPU å†…æ ¸å¼€ç®±å³ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œè¿˜æœ‰åŠ©äº Node è¿›ç¨‹å¢åŠ å¯ç”¨æ€§çš„èƒ½åŠ›ï¼Œå¦å¤–è¿˜æä¾›äº†ä¸€ä¸ªé€‰é¡¹ï¼šæ— åœæœºé‡å¯æ•´ä¸ªåº”ç”¨çš„èƒ½åŠ›ã€‚")]),t._v(" "),n("p",[t._v("å·¥ä½œé‡æ˜¯æˆ‘ä»¬æ‰©å±•åº”ç”¨çš„æœ€æ™®éçš„ç†ç”±ï¼Œä½†åŒæ—¶æˆ‘ä»¬ä¹Ÿé€šè¿‡æ‰©å±•åº”ç”¨å¢åŠ å¯ç”¨æ€§å’Œå®¹ç¾èƒ½åŠ›ã€‚")]),t._v(" "),n("p",[t._v("å®é™…ä¸Šï¼Œä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸‰ç§ç­–ç•¥æé«˜åº”ç”¨çš„å¯ä¼¸ç¼©æ€§ã€‚")]),t._v(" "),n("h3",{attrs:{id:"å…‹éš†"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å…‹éš†"}},[t._v("#")]),t._v(" å…‹éš†")]),t._v(" "),n("p",[t._v("æ‰©å±•å¤§å‹åº”ç”¨æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å¤šæ¬¡å…‹éš†å¹¶ä¸”å…‹éš†å®ä¾‹å¤„ç†è´Ÿè½½çš„ä¸€éƒ¨åˆ†ï¼ˆä¾‹å¦‚ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ï¼‰ã€‚å¹¶ä¸ä¼šèŠ±è´¹å¤ªå¤šçš„å¼€å‘äº‹ä»¶å¹¶ä¸”éå¸¸æœ‰æ•ˆã€‚ç­–ç•¥å°±æ˜¯åšæœ€å°åŒ–çš„äº‹æƒ…å¹¶ä¸” Node.js æœ‰å†…ç½®æ¨¡å— clusterï¼Œåœ¨æœåŠ¡å™¨ä¸Šé¢å®ç°ä¸€ä¸ªå…‹éš†ç­–ç•¥éå¸¸å®¹æ˜“ã€‚")]),t._v(" "),n("h3",{attrs:{id:"åˆ†è§£"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†è§£"}},[t._v("#")]),t._v(" åˆ†è§£")]),t._v(" "),n("p",[t._v("æˆ‘ä»¬å¯ä»¥åŸºäºåŠŸèƒ½å’ŒæœåŠ¡é€šè¿‡åˆ†è§£æ‰©å±•ä¸€ä¸ªåº”ç”¨ã€‚è¿™æ„å‘³ç€ç”¨ä¸åŒçš„ä»£ç å®ç°å¤šæ ·çš„åº”ç”¨ï¼Œæœ‰æ—¶å€™æœ‰ä¸“å±çš„æ•°æ®åº“å’Œç”¨æˆ·ç•Œé¢ã€‚")]),t._v(" "),n("p",[t._v("è¿™ç§ç­–ç•¥é€šå¸¸ä¸ "),n("strong",[t._v("å¾®æœåŠ¡ï¼ˆMicroserviceï¼‰")]),t._v(" æœ‰å…³ï¼Œ"),n("strong",[t._v("å¾®")]),t._v("æŒ‡çš„æ˜¯è¿™äº›æœåŠ¡åº”è¯¥å°½å¯èƒ½åœ°å°ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œæœ€é‡è¦çš„ä¸æ˜¯æœåŠ¡çš„å¤§å°ï¼Œè€Œæ˜¯æœåŠ¡ä¹‹é—´çš„æ¾è€¦åˆå’Œé«˜å†…èšã€‚è¿™ä¸ªç­–ç•¥çš„å®ç°å¹¶ä¸å®¹æ˜“å¹¶ä¸”å¯èƒ½å¯¼è‡´é•¿æœŸçš„å‡ºä¹æ„æ–™çš„é—®é¢˜ï¼Œä½†æ˜¯åšå¥½ä¹‹åï¼Œæœ‰ç‚¹è¿˜æ˜¯éå¸¸å¤§çš„ã€‚")]),t._v(" "),n("h3",{attrs:{id:"æ‹†åˆ†"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ‹†åˆ†"}},[t._v("#")]),t._v(" æ‹†åˆ†")]),t._v(" "),n("p",[t._v("æˆ‘ä»¬å¯ä»¥å°†åº”ç”¨åˆ†æˆå¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹è´Ÿè´£åº”ç”¨æ•°æ®çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸ªç­–ç•¥æ˜¯åœ¨æ•°æ®åº“ä¸Š "),n("strong",[t._v("æ°´å¹³åˆ‡åˆ†ï¼ˆhorizontal paritioningï¼‰")]),t._v("ï¼Œæˆ–è€…"),n("strong",[t._v("åˆ†åŒºï¼ˆshardingï¼‰")]),t._v("ã€‚æ•°æ®åˆ†åŒºåœ¨æ¯ä¸ªæ“ä½œä½¿ç”¨å“ªä¸ªåº”ç”¨å®ä¾‹ä¹‹å‰éœ€è¦æœ‰ä¸€ä¸ªæŸ¥æ‰¾çš„æ­¥éª¤ã€‚ä¾‹å¦‚ä¹Ÿè®¸æˆ‘ä»¬é€šè¿‡ç”¨æˆ·çš„å›½å®¶å’Œè¯­è¨€è¿›è¡Œåˆ†åŒºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªæ•°æ®ä¿¡æ¯çš„æŸ¥æ‰¾ã€‚")]),t._v(" "),n("h2",{attrs:{id:"å†…éƒ¨é€šä¿¡æŠ€å·§"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å†…éƒ¨é€šä¿¡æŠ€å·§"}},[t._v("#")]),t._v(" å†…éƒ¨é€šä¿¡æŠ€å·§")]),t._v(" "),n("p",[t._v("åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ "),n("code",[t._v("process.on('message', fn)")]),t._v(" æ¥å®ç°è¿›ç¨‹é—´é€šä¿¡ã€‚")]),t._v(" "),n("p",[t._v("å‰é¢æåˆ°ï¼Œmaster è¿›ç¨‹ã€worker è¿›ç¨‹åœ¨ server å®ä¾‹çš„åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œä¹Ÿæ˜¯é€šè¿‡ IPC é€šé“è¿›è¡Œé€šä¿¡çš„ã€‚é‚£ä¼šä¸ä¼šå¯¹æˆ‘ä»¬çš„å¼€å‘é€ æˆå¹²æ‰°å‘¢ï¼Ÿæ¯”å¦‚ï¼Œæ”¶åˆ°ä¸€å †å…¶å®å¹¶ä¸éœ€è¦å…³å¿ƒçš„ä¿¡æ¯ï¼Ÿ")]),t._v(" "),n("p",[t._v("ç­”æ¡ˆè‚¯å®šæ˜¯ä¸ä¼šï¼Œé‚£ä¹ˆæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ")]),t._v(" "),n("p",[t._v("å½“å‘é€çš„æ¶ˆæ¯åŒ…å« "),n("code",[t._v("cmd")]),t._v(" å­—æ®µï¼Œä¸”æ”¹å­—æ®µä»¥ "),n("code",[t._v("NODE_")]),t._v(" ä½œä¸ºå‰ç¼€ï¼Œåˆ™è¯¥æ¶ˆæ¯ä¼šè¢«è§†ä¸ºå†…éƒ¨åŒ…æ‹¬ä¿ç•™çš„æ¶ˆæ¯ï¼Œä¸ä¼šé€šè¿‡ "),n("code",[t._v("message")]),t._v(" äº‹ä»¶æŠ›å‡ºï¼Œä½†å¯ä»¥é€šè¿‡ç›‘å¬ "),n("code",[t._v("internalMessage")]),t._v(" æ•è·ã€‚")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// worker è¿›ç¨‹")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" message "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  cmd"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NODE_CLUSTER'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  act"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'queryServer'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nprocess"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("hr"),t._v(" "),n("p",[n("strong",[t._v("å‚è€ƒèµ„æ–™ï¼š")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/chyingp/nodejs-learning-guide/blob/master/%E6%A8%A1%E5%9D%97/cluster.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("ğŸ“ node-learning-guide: cluster"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"http://www.alloyteam.com/2015/08/nodejs-cluster-tutorial/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ğŸ“ è…¾è®¯ AlloyTeamï¼šè§£è¯» Node.js çš„ cluster æ¨¡å—"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://mp.weixin.qq.com/s/Xm_c841UdKA06s76rJ_4nw",target:"_blank",rel:"noopener noreferrer"}},[t._v("ğŸ“ çŒ«çœ¼å‰ç«¯ï¼šæ·±å…¥æµ…å‡º Node.js Cluster"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/36728299",target:"_blank",rel:"noopener noreferrer"}},[t._v("ğŸ“ Node.js é›†ç¾¤ï¼ˆclusterï¼‰ï¼šæ‰©å±•ä½ çš„ Node.js åº”ç”¨"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/41118827",target:"_blank",rel:"noopener noreferrer"}},[t._v("ğŸ“ Node.jsï¼šæµ…æé«˜å¹¶å‘ä¸åˆ†å¸ƒå¼é›†ç¾¤"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://fed.taobao.org/blog/2015/11/04/nodejs-cluster/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ğŸ“ æ·˜å®å‰ç«¯ï¼šå½“æˆ‘ä»¬è°ˆè®º cluster æ—¶æˆ‘ä»¬åœ¨è°ˆè®ºä»€ä¹ˆ"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://www.cnblogs.com/accordion/p/7207740.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ğŸ“ Node.js cluster æ¨¡å—æ·±å…¥ç ”ç©¶"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);