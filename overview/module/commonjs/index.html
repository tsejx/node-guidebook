<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/node-guidebook/umi.css" />
    <script>
      window.routerBase = "/node-guidebook/";
    </script>
    <script>
      //! umi version: 3.5.20
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.indexOf(e) > -1 ? e : r[0]
        );
      })();
    </script>
    <title>CommonJS - Node Guidebook</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/overview/module/commonjs" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//">Node Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a aria-current="page" class="active" href="/node-guidebook//overview">æ¦‚è§ˆ</a></span><span><a href="/node-guidebook//engine">å¼•æ“</a></span><span><a href="/node-guidebook//system">ç³»ç»Ÿ</a></span><span><a href="/node-guidebook//network">ç½‘ç»œ</a></span><span><a href="/node-guidebook//server-application">æœåŠ¡ç«¯åº”ç”¨</a></span><span><a href="/node-guidebook//util-application">å·¥å…·åº”ç”¨</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//"></a><h1>Node Guidebook</h1><p>Node å®Œå…¨çŸ¥è¯†ä½“ç³»</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a aria-current="page" class="active" href="/node-guidebook//overview">æ¦‚è§ˆ</a></li><li><a href="/node-guidebook//engine">å¼•æ“</a></li><li><a href="/node-guidebook//system">ç³»ç»Ÿ</a></li><li><a href="/node-guidebook//network">ç½‘ç»œ</a></li><li><a href="/node-guidebook//server-application">æœåŠ¡ç«¯åº”ç”¨</a></li><li><a href="/node-guidebook//util-application">å·¥å…·åº”ç”¨</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a target="_blank" rel="noopener noreferrer">æ¶æ„</a><ul><li><a href="/node-guidebook//overview/basic"><span>æ¦‚è§ˆ</span></a></li><li><a href="/node-guidebook//overview/basic/execution"><span>è¿è¡Œæœºåˆ¶</span></a></li><li><a href="/node-guidebook//overview/basic/memory"><span>å†…å­˜æ§åˆ¶</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">æ¨¡å—æœºåˆ¶</a><ul><li><a aria-current="page" class="active" href="/node-guidebook//overview/module/commonjs"><span>CommonJS</span></a></li><li><a href="/node-guidebook//overview/module/module"><span>æ¨¡å—æœºåˆ¶</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">ç”Ÿæ€</a><ul><li><a href="/node-guidebook//overview/ecology/npm"><span>npm åŒ…æè¿°æ–‡ä»¶</span></a></li><li><a href="/node-guidebook//overview/ecology/npm-version"><span>npm ç‰ˆæœ¬ç®¡ç†</span></a></li><li><a href="/node-guidebook//overview/ecology/npm-command"><span>npm è„šæœ¬å‘½ä»¤</span></a></li><li><a href="/node-guidebook//overview/ecology/npm-configuration"><span>npm é…ç½®æ–‡ä»¶</span></a></li><li><a href="/node-guidebook//overview/ecology/npx"><span>npx</span></a></li><li><a href="/node-guidebook//overview/ecology/nvm"><span>nvm</span></a></li><li><a href="/node-guidebook//overview/ecology/nrm"><span>nrm</span></a></li></ul></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="module" data-depth="2"><a href="/node-guidebook//overview/module/commonjs#module"><span>module</span></a></li><li title="module.exports å±æ€§" data-depth="3"><a href="/node-guidebook//overview/module/commonjs#moduleexports-å±æ€§"><span>module.exports å±æ€§</span></a></li><li title="exports å˜é‡" data-depth="3"><a href="/node-guidebook//overview/module/commonjs#exports-å˜é‡"><span>exports å˜é‡</span></a></li><li title="æ¨¡å—å¯¼å‡ºæºç åˆ†æ" data-depth="3"><a href="/node-guidebook//overview/module/commonjs#æ¨¡å—å¯¼å‡ºæºç åˆ†æ"><span>æ¨¡å—å¯¼å‡ºæºç åˆ†æ</span></a></li><li title="æ¨¡å—åŠ è½½åŸç†ç®€è¿°" data-depth="3"><a href="/node-guidebook//overview/module/commonjs#æ¨¡å—åŠ è½½åŸç†ç®€è¿°"><span>æ¨¡å—åŠ è½½åŸç†ç®€è¿°</span></a></li><li title="require" data-depth="2"><a href="/node-guidebook//overview/module/commonjs#require"><span>require</span></a></li><li title="åŠ è½½è§„åˆ™" data-depth="3"><a href="/node-guidebook//overview/module/commonjs#åŠ è½½è§„åˆ™"><span>åŠ è½½è§„åˆ™</span></a></li><li title="ç›®å½•çš„åŠ è½½è§„åˆ™" data-depth="3"><a href="/node-guidebook//overview/module/commonjs#ç›®å½•çš„åŠ è½½è§„åˆ™"><span>ç›®å½•çš„åŠ è½½è§„åˆ™</span></a></li><li title="æ¨¡å—çš„ç¼“å­˜" data-depth="3"><a href="/node-guidebook//overview/module/commonjs#æ¨¡å—çš„ç¼“å­˜"><span>æ¨¡å—çš„ç¼“å­˜</span></a></li><li title="å¾ªç¯åŠ è½½" data-depth="3"><a href="/node-guidebook//overview/module/commonjs#å¾ªç¯åŠ è½½"><span>å¾ªç¯åŠ è½½</span></a></li><li title="require.main" data-depth="3"><a href="/node-guidebook//overview/module/commonjs#requiremain"><span>require.main</span></a></li><li title="require.resolve" data-depth="3"><a href="/node-guidebook//overview/module/commonjs#requireresolve"><span>require.resolve</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="commonjs"><a aria-hidden="true" tabindex="-1" href="/node-guidebook//overview/module/commonjs#commonjs"><span class="icon icon-link"></span></a>CommonJS</h1><p>Node.js åº”ç”¨ç”±æ¨¡å—ç»„æˆï¼Œé‡‡ç”¨ CommonJS æ¨¡å—è§„èŒƒã€‚</p><p>æ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢å®šä¹‰çš„å˜é‡ã€å‡½æ•°ã€ç±»ï¼Œéƒ½æ˜¯ç§æœ‰çš„ï¼Œå¯¹å…¶ä»–æ–‡ä»¶ä¸å¯è§ã€‚</p><p>å¦‚æœæƒ³åœ¨å¤šä¸ªæ–‡ä»¶åˆ†äº«å˜é‡ï¼Œå¿…é¡»å®šä¹‰ä¸º <code>global</code> å¯¹è±¡çš„å±æ€§ã€‚</p><p>CommonJS è§„èŒƒè§„å®šï¼Œæ¯ä¸ªæ¨¡å—å†…éƒ¨ï¼Œ<code>module</code> å˜é‡ä»£è¡¨å½“å‰æ¨¡å—ã€‚è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„ <code>exports</code> å±æ€§ï¼ˆå³ <code>module.exports</code>ï¼‰æ˜¯å¯¹å¤–çš„æ¥å£ã€‚åŠ è½½æŸä¸ªæ¨¡å—ï¼Œå…¶å®æ˜¯åŠ è½½è¯¥æ¨¡å—çš„ <code>module.exports</code> å±æ€§ã€‚</p><p>CommonJS æ¨¡å—çš„ç‰¹ç‚¹ï¼š</p><ul><li>æ‰€æœ‰ä»£ç éƒ½è¿è¡Œåœ¨æ¨¡å—ä½œç”¨åŸŸï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸ</li><li>æ¨¡å—å¯ä»¥å¤šæ¬¡åŠ è½½ï¼Œä½†æ˜¯åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½æ—¶è¿è¡Œä¸€æ¬¡ï¼Œç„¶åè¿è¡Œç»“æœå°±è¢«ç¼“å­˜äº†ï¼Œä»¥åå†åŠ è½½ï¼Œå°±ç›´æ¥è¯»å–ç¼“å­˜ç»“æœã€‚è¦æƒ³è®©æ¨¡å—å†æ¬¡è¿è¡Œï¼Œå¿…é¡»æ¸…é™¤ç¼“å­˜</li><li>æ¨¡å—åŠ è½½çš„é¡ºåºï¼ŒæŒ‰ç…§å…¶åœ¨ä»£ç ä¸­å‡ºç°çš„é¡ºåº</li></ul><h2 id="module"><a aria-hidden="true" tabindex="-1" href="/node-guidebook//overview/module/commonjs#module"><span class="icon icon-link"></span></a>module</h2><p>Node.js å†…éƒ¨æä¾›ä¸€ä¸ª <a target="_blank" rel="noopener noreferrer" href="https://github.com/nodejs/node/blob/master/lib/internal/modules/cjs/loader.js">Module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ„å»ºå‡½æ•°ã€‚æ‰€æœ‰æ¨¡å—éƒ½æ˜¯ Module çš„å®ä¾‹ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// é Node NativeModule</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">Module</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token parameter punctuation">,</span><span class="token parameter"> parent</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// æ¨¡å—æ ‡è¯†ç¬¦</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> id</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// è°ƒç”¨è¯¥æ¨¡å—çš„æ¨¡å—</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">parent</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> parent</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// æ¨¡å—å¯¹å¤–è¾“å‡ºçš„å€¼</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">path</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token method function property-access">dirname</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">filename</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">loaded</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token plain">parent</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// Native Module</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">NativeModule</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">filename</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">id</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">.js</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> id</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">module</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword nil">undefined</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">exportKeys</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword nil">undefined</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">loaded</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">loading</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">canBeRequiredByUsers</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">!</span><span class="token plain">id</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span><span class="token string">&#x27;internal/&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>æ¯ä¸ªæ¨¡å—å†…éƒ¨ï¼Œéƒ½æœ‰ä¸€ä¸ª <code>module</code> å¯¹è±¡ï¼Œä»£è¡¨å½“å‰æ¨¡å—ã€‚å®ƒæœ‰ä»¥ä¸‹å±æ€§ã€‚</p><ul><li><code>module.id</code>ï¼šæ¨¡å—çš„è¯†åˆ«ç¬¦ï¼Œé€šå¸¸æ˜¯å¸¦æœ‰ç»å¯¹è·¯å¾„çš„æ¨¡å—æ–‡ä»¶å</li><li><code>module.filename</code>ï¼šæ¨¡å—çš„æ–‡ä»¶åï¼Œå¸¦æœ‰ç»å¯¹è·¯å¾„</li><li><code>module.loaded</code>ï¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ¨¡å—æ˜¯å¦å·²ç»å®ŒæˆåŠ è½½</li><li><code>module.parent</code>ï¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºè°ƒç”¨è¯¥æ¨¡å—çš„æ¨¡å—</li><li><code>module.children</code>ï¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºè¯¥æ¨¡å—è¦ç”¨åˆ°çš„å…¶ä»–æ¨¡å—</li><li><code>module.exports</code>ï¼šè¡¨ç¤ºæ¨¡å—å¯¹å¤–è¾“å‡ºçš„å€¼</li></ul><p>ğŸŒ° <strong>ç¤ºä¾‹ï¼š</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// index.js</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> jquery </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;jquery&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token property-access">$</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> jquery</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">module</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>æ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œå‘½ä»¤è¡Œä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;.&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token literal-property property">exports</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string-property property">&#x27;$&#x27;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token known-class-name class-name">Function</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token literal-property property">parent</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/path/to/example.js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token literal-property property">loaded</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token literal-property property">children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/path/to/node_modules/jquery/dist/jquery.js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token literal-property property">exports</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token known-class-name class-name">Function</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token literal-property property">parent</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token maybe-class-name">Circular</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/path/to/node_modules/jquery/dist/jquery.js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token literal-property property">loaded</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token literal-property property">children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token literal-property property">paths</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token known-class-name class-name">Object</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token literal-property property">paths</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">     </span><span class="token string">&#x27;/home/user/deleted/node_modules&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">     </span><span class="token string">&#x27;/home/user/node_modules&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">     </span><span class="token string">&#x27;/home/node_modules&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">     </span><span class="token string">&#x27;/node_modules&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><ul><li>è‹¥åœ¨å‘½ä»¤è¡Œä¸‹è°ƒç”¨è¯¥æ¨¡å—ï¼Œæ¯”å¦‚ <code>node index.js</code>ï¼Œåˆ™ <code>module.parent</code> ä¸º <code>null</code>ã€‚</li><li>è‹¥åœ¨è„šæœ¬ä¹‹ä¸­è°ƒç”¨ï¼Œæ¯”å¦‚ <code>require(&#x27;./index.js)</code>ï¼Œåˆ™ <code>module.parent</code> å°±æ˜¯è°ƒç”¨å®ƒçš„æ¨¡å—ã€‚</li></ul><p>ğŸ’¡ åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå¯ä»¥åˆ¤æ–­å½“å‰æ¨¡å—æ˜¯å¦ä¸ºå…¥å£è„šæœ¬ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">parent</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// ran with `node index.js`</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  app</span><span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;app listening on port 8080&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// used with `require(&#x27;./index.js&#x27;)`</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> app</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><h3 id="moduleexports-å±æ€§"><a aria-hidden="true" tabindex="-1" href="/node-guidebook//overview/module/commonjs#moduleexports-å±æ€§"><span class="icon icon-link"></span></a>module.exports å±æ€§</h3><p><code>module.exports</code> å±æ€§è¡¨ç¤ºå½“å‰æ¨¡å—å¯¹å¤–è¾“å‡ºçš„æ¥å£ï¼Œå…¶ä»–æ–‡ä»¶åŠ è½½è¯¥æ¨¡å—ï¼Œå®é™…ä¸Šå°±æ˜¯è¯»å– <code>module.exports</code> å˜é‡ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">EventEmitter</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;events&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">EventEmitter</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">.</span><span class="token method function property-access">emit</span><span class="token punctuation">(</span><span class="token string">&#x27;ready&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>ä¸Šè¿°æ¨¡å—ä¼šåœ¨åŠ è½½å 1 ç§’åï¼Œå‘å‡º ready äº‹ä»¶ã€‚å…¶ä»–æ–‡ä»¶ç›‘å¬è¯¥äº‹ä»¶ï¼Œå¯ä»¥å†™æˆä¸‹é¢è¿™æ ·ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> eventEmitter </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./eventEmitter&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">eventEmitter</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&#x27;ready&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;module eventEmitter is ready&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="exports-å˜é‡"><a aria-hidden="true" tabindex="-1" href="/node-guidebook//overview/module/commonjs#exports-å˜é‡"><span class="icon icon-link"></span></a>exports å˜é‡</h3><p>ä¸ºäº†æ–¹ä¾¿ï¼ŒNode ä¸ºæ¯ä¸ªæ¨¡å—æä¾›äº†ä¸€ä¸ª <code>exports</code> å˜é‡ï¼ŒæŒ‡å‘ <code>module.exports</code>ã€‚è¿™ç­‰åŒåœ¨æ¯ä¸ªæ¨¡å—å¤´éƒ¨ï¼Œæœ‰è¿™æ ·ä¸€è¡Œå‘½ä»¤ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> exports </span><span class="token operator">=</span><span class="token plain"> module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">;</span></div></pre></div><p>å› æ­¤ï¼Œåœ¨å¯¹å¤–è¾“å‡ºæ¨¡å—æ¥å£æ—¶ï¼Œå¯ä»¥å‘ <code>exports</code> å¯¹è±¡çš„ <strong>å±æ€§</strong> æ·»åŠ  <strong>æ–¹æ³•</strong> å’Œ <strong>å€¼</strong>ã€‚ï¼ˆæ³¨æ„æ˜¯ <code>exports</code> å¯¹è±¡çš„å±æ€§ï¼‰</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">area</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> r </span><span class="token operator">*</span><span class="token plain"> r</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">circumference</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> r</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;mrsingsing&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token property-access">age</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">25</span><span class="token punctuation">;</span></div></pre></div><p>æ³¨æ„ï¼Œä¸èƒ½å°† exports å˜é‡ç›´æ¥æŒ‡å‘ä¸€ä¸ªå€¼ï¼Œå› ä¸ºè¿™æ ·ç­‰äºæ–­äº† <code>exports</code> å’Œ <code>module.exports</code> çš„è”ç³»ã€‚</p><p>é‚£å¦‚ä¸‹ç»“æœä¼šå¦‚ä½•å¯¼å‡ºï¼Ÿ</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// ç›¸å½“äºæ–­å¼€äº†ä¸ module.exports çš„è”ç³»</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// äº¦å³æ—¶ exports ä¸å†æŒ‡å‘ module.exports çš„å†…å­˜åœ°å€</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// éœ€è¦ exports.value = 3 æ‰èƒ½å¯¼å‡º</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">exports </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">;</span></div></pre></div><p>å¾ˆæ˜¾ç„¶ä¼šå¯¼å‡º 100ï¼Œæ¯•ç«Ÿ <code>exports</code> è¿›è¡Œäº†é‡æŒ‡å‘ã€‚</p><p>ä»¥ä¸‹å†™æ³•æ˜¯æ— æ•ˆçš„ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function-variable function">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">x</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p>ä¸‹é¢çš„å†™æ³•ä¹Ÿæ˜¯æ— æ•ˆçš„ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">hello</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;Hello world!&#x27;</span><span class="token punctuation">;</span></div></pre></div><p>ä¸Šé¢ä»£ç ï¼Œ<code>hello</code> å‡½æ•°æ˜¯æ— æ³•å¯¹å¤–è¾“å‡ºçš„ï¼Œå› ä¸º <code>module.exports</code> è¢«é‡æ–°èµ‹å€¼äº†ã€‚</p><ul><li>è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸€ä¸ªæ¨¡å—çš„å¯¹å¤–æ¥å£ï¼Œå°±æ˜¯ä¸€ä¸ªå•ä¸€çš„å€¼ï¼Œä¸èƒ½ä½¿ç”¨ <code>exports</code> è¾“å‡ºï¼Œåªèƒ½ä½¿ç”¨ <code>module.exports</code> è¾“å‡ºã€‚</li><li>å¦‚æœè¦è¾“å‡ºå¤šä¸ªå€¼ï¼Œåˆ™éœ€è¦æŒ‚è½½åˆ° <code>exports</code> èº«ä¸Šï¼Œä¾‹å¦‚ <code>exports.a = xx</code>ã€<code>exports.b = xx</code>ã€‚</li></ul><p>å¦‚æœè§‰å¾— <code>exports</code> å’Œ <code>module.exports</code> ä¹‹é—´çš„åŒºåˆ«å¾ˆéš¾åˆ†æ¸…ï¼Œä¸€ä¸ªç®€å•çš„å¤„ç†æ–¹æ³•ï¼Œå°±æ˜¯æ”¾å¼ƒä½¿ç”¨ <code>exports</code>ï¼Œåªä½¿ç”¨ <code>module.exports</code>ã€‚</p><h3 id="æ¨¡å—å¯¼å‡ºæºç åˆ†æ"><a aria-hidden="true" tabindex="-1" href="/node-guidebook//overview/module/commonjs#æ¨¡å—å¯¼å‡ºæºç åˆ†æ"><span class="icon icon-link"></span></a>æ¨¡å—å¯¼å‡ºæºç åˆ†æ</h3><p>ä»æºç ä¸­å¯ä»¥çœ‹å‡º <code>exports</code> çš„å®è´¨ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> dirname </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token method function property-access">dirname</span><span class="token punctuation">(</span><span class="token plain">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> require </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">makeRequireFunction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token plain"> redirects</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> result</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// ç›¸å½“äº exports å¼•ç”¨ module.exports</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> exports </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> thisValue </span><span class="token operator">=</span><span class="token plain"> exports</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> module </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">requireDepth </span><span class="token operator">===</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"> statCache </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">inspectorWrapper</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">inspectorWrapper</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    compiledWrapper</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    thisValue</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    exports</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    require</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    module</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    filename</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    dirname</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  result </span><span class="token operator">=</span><span class="token plain"> compiledWrapper</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain">thisValue</span><span class="token punctuation">,</span><span class="token plain"> exports</span><span class="token punctuation">,</span><span class="token plain"> require</span><span class="token punctuation">,</span><span class="token plain"> module</span><span class="token punctuation">,</span><span class="token plain"> filename</span><span class="token punctuation">,</span><span class="token plain"> dirname</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>è€Œ Node ä¸­æ‰€æœ‰çš„æ¨¡å—ä»£ç éƒ½ä¼šè¢«åŒ…è£¹åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// __filename å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// __dirname  å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token parameter punctuation">,</span><span class="token parameter"> require</span><span class="token parameter punctuation">,</span><span class="token parameter"> module</span><span class="token parameter punctuation">,</span><span class="token parameter"> __filename</span><span class="token parameter punctuation">,</span><span class="token parameter"> __dirname</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  exports</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="æ¨¡å—åŠ è½½åŸç†ç®€è¿°"><a aria-hidden="true" tabindex="-1" href="/node-guidebook//overview/module/commonjs#æ¨¡å—åŠ è½½åŸç†ç®€è¿°"><span class="icon icon-link"></span></a>æ¨¡å—åŠ è½½åŸç†ç®€è¿°</h3><ul><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.im/post/6844904042037002254">Node çš„æ¨¡å—è¿è¡Œæœºåˆ¶<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><img alt="Module Load" src="/node-guidebook/static/module-load-workflow.9dcc786c.png" width="640"/><div class="markdown"><p>å‚è€ƒæºç ï¼š<a target="_blank" rel="noopener noreferrer" href="https://github.com/nodejs/node/blob/master/lib/internal/modules/cjs/loader.js">node/lib/internal/modules/cjs/loader.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// Check the cache for the requested file.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 1. If a module already exists in the cache: return its exports object.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 2. If the module is native: call</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//    `NativeModule.prototype.compileForPublicLoader()` and return the exports.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 3. Otherwise, create a new module for the file and save it to the cache.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//    Then have it load  the file contents before returning its exports</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//    object.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Module</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">_load</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token parameter punctuation">,</span><span class="token parameter"> parent</span><span class="token parameter punctuation">,</span><span class="token parameter"> isMain</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> relResolveCacheIdentifier</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">parent</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&#x27;Module._load REQUEST %s parent: %s&#x27;</span><span class="token punctuation">,</span><span class="token plain"> request</span><span class="token punctuation">,</span><span class="token plain"> parent</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token spread operator">...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// æŸ¥æ‰¾æ–‡ä»¶å…·ä½“ä½ç½®</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> filename </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Module</span><span class="token punctuation">.</span><span class="token method function property-access">_resolveFilename</span><span class="token punctuation">(</span><span class="token plain">request</span><span class="token punctuation">,</span><span class="token plain"> parent</span><span class="token punctuation">,</span><span class="token plain"> isMain</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// å­˜åœ¨ç¼“å­˜ï¼Œåˆ™ä¸éœ€è¦å†æ¬¡æ‰§è¡Œ è¿”å›ç¼“å­˜</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> cachedModule </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Module</span><span class="token punctuation">.</span><span class="token property-access">_cache</span><span class="token punctuation">[</span><span class="token plain">filename</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">cachedModule </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token plain">parent</span><span class="token punctuation">,</span><span class="token plain"> cachedModule</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">cachedModule</span><span class="token punctuation">.</span><span class="token property-access">loaded</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token function">getExportsForCircularRequire</span><span class="token punctuation">(</span><span class="token plain">cachedModule</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> cachedModule</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// åŠ è½½nodeåŸç”Ÿæ¨¡å—ï¼ŒåŸç”Ÿæ¨¡å—loadNativeModule</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// å¦‚æœæœ‰ ä¸”èƒ½è¢«ç”¨æˆ·å¼•ç”¨ è¿”å› mod.exportsï¼ˆè¿™åŒ…æ‹¬nodeæ¨¡å—çš„ç¼–è¯‘åˆ›å»ºmoduleå¯¹è±¡ï¼Œå°†æ¨¡å—è¿è¡Œç»“æœä¿å­˜åœ¨moduleå¯¹è±¡ä¸Šï¼‰</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> mod </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">loadNativeModule</span><span class="token punctuation">(</span><span class="token plain">filename</span><span class="token punctuation">,</span><span class="token plain"> request</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">mod </span><span class="token operator">&amp;&amp;</span><span class="token plain"> mod</span><span class="token punctuation">.</span><span class="token property-access">canBeRequiredByUsers</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword control-flow">return</span><span class="token plain"> mod</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// åˆ›å»ºä¸€ä¸ªæ¨¡å—</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// Don&#x27;t call updateChildren(), Module constructor already does.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> module </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Module</span><span class="token punctuation">(</span><span class="token plain">filename</span><span class="token punctuation">,</span><span class="token plain"> parent</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">isMain</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      process</span><span class="token punctuation">.</span><span class="token property-access">mainModule</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> module</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      module</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;.&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ç¼“å­˜æ¨¡å—</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token maybe-class-name">Module</span><span class="token punctuation">.</span><span class="token property-access">_cache</span><span class="token punctuation">[</span><span class="token plain">filename</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> module</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">parent </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      relativeResolveCache</span><span class="token punctuation">[</span><span class="token plain">relResolveCacheIdentifier</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> filename</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// åŠ è½½æ‰§è¡Œæ–°çš„æ¨¡å—</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    module</span><span class="token punctuation">.</span><span class="token method function property-access">load</span><span class="token punctuation">(</span><span class="token plain">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p>Node ç¼“å­˜çš„æ˜¯ç¼–è¯‘å’Œæ‰§è¡Œåçš„å¯¹è±¡ï¼š</p><ul><li>ç›¸åŒ<ul><li>Node æ¨¡å—å’Œé Node å¢¨èŠçˆ±ç»å†çš„è¿‡ç¨‹éƒ½æ˜¯ï¼Œæœ‰æ‰§è¡Œåçš„ç¼“å­˜å¯¹è±¡ï¼Œè¿”å›ç¼“å­˜å¯¹è±¡</li><li>æ²¡æœ‰æ‰§è¡Œåçš„ç¼“å­˜å¯¹è±¡ï¼Œåˆ›å»º <code>module</code> å¯¹è±¡ï¼Œæ‰§è¡Œæ¨¡å—ï¼Œå­˜å‚¨æ‰§è¡Œåå¾—åˆ°çš„å¯¹è±¡ï¼Œè¿”å›æ‰§è¡Œåçš„ç»“æœ <code>exports</code></li></ul></li><li>ä¸åŒ<ul><li>ç¼“å­˜å¯¹è±¡ä¸åŒ</li><li>åŠ è½½æ¨¡å—æ–‡ä»¶æ–¹å¼ä¸åŒ</li></ul></li></ul><h2 id="require"><a aria-hidden="true" tabindex="-1" href="/node-guidebook//overview/module/commonjs#require"><span class="icon icon-link"></span></a>require</h2><p>Node ä½¿ç”¨ CommonJS æ¨¡å—è§„èŒƒï¼Œå†…ç½®çš„ <code>require</code> å‘½ä»¤ç”¨äºåŠ è½½æ¨¡å—æ–‡ä»¶ã€‚</p><p><code>require</code> å‘½ä»¤çš„åŸºæœ¬åŠŸèƒ½å°±æ˜¯ï¼Œè¯»å…¥å¹¶æ‰§è¡Œä¸€ä¸ª JavaScript æ–‡ä»¶ï¼Œç„¶åè¿”å›è¯¥æ¨¡å—çš„ <code>exports</code> å¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰å‘ç°æŒ‡å®šæ¨¡å—ï¼Œä¼šæŠ¥é”™ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// index.js</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> </span><span class="token function-variable function">invisible</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;invisible&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;hi&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">say</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">message</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p>å¦‚æœæ¨¡å—è¾“å‡ºçš„ä»…æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œé‚£å°±ä¸èƒ½å®šä¹‰åœ¨ <code>exports</code> å¯¹è±¡ä¸Šï¼Œè€Œè¦å®šä¹‰åœ¨ <code>module.exports</code> å˜é‡ä¸Šã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;hello world!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./index.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>require</code> å‘½ä»¤è°ƒç”¨è‡ªèº«ï¼Œç­‰äºæ˜¯æ‰§è¡Œ <code>module.exports</code>ï¼Œå› æ­¤ä¼šè¾“å‡º <code>hello world!</code>ã€‚</p><h3 id="åŠ è½½è§„åˆ™"><a aria-hidden="true" tabindex="-1" href="/node-guidebook//overview/module/commonjs#åŠ è½½è§„åˆ™"><span class="icon icon-link"></span></a>åŠ è½½è§„åˆ™</h3><p><code>require</code> å‘½ä»¤ç”¨äºåŠ è½½æ–‡ä»¶ï¼Œåç¼€åé»˜è®¤ä¸º <code>.js</code>ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">var</span><span class="token plain"> foo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//  ç­‰åŒäº</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> foo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;foo.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>æ ¹æ®å‚æ•°çš„ä¸åŒæ ¼å¼ï¼Œ<code>require</code> å‘½ä»¤å»ä¸åŒè·¯å¾„å¯»æ‰¾æ¨¡å—æ–‡ä»¶ã€‚</p><ol><li><p>å¦‚æœå‚æ•°å­—ç¬¦ä¸²ä»¥ <code>/</code> å¼€å¤´ï¼Œåˆ™è¡¨ç¤ºåŠ è½½çš„æ˜¯ä¸€ä¸ªä½äº<strong>ç»å¯¹è·¯å¾„</strong>çš„æ¨¡å—æ–‡ä»¶ã€‚æ¯”å¦‚ï¼Œ<code>require(&#x27;/home/marco/foo.js&#x27;)</code> å°†åŠ è½½ <code>/home/marco/foo.js</code>ã€‚</p></li><li><p>å¦‚æœå‚æ•°å­—ç¬¦ä¸²ä»¥ <code>./</code> å¼€å¤´ï¼Œåˆ™è¡¨ç¤ºåŠ è½½çš„æ˜¯ä¸€ä¸ªä½äº<strong>ç›¸å¯¹è·¯å¾„</strong>ï¼ˆè·Ÿå½“å‰æ‰§è¡Œè„šæœ¬çš„ä½ç½®ç›¸æ¯”ï¼‰çš„æ¨¡å—æ–‡ä»¶ã€‚æ¯”å¦‚ï¼Œ<code>require(&#x27;./foo&#x27;)</code> å°†åŠ è½½å½“å‰ç›®å½•ä¸‹çš„ <code>foo.js</code>ã€‚</p></li><li><p>å¦‚æœå‚æ•°å­—ç¬¦ä¸²ä¸ä»¥ <code>./</code> æˆ– <code>/</code> å¼€å¤´ï¼Œåˆ™è¡¨ç¤ºåŠ è½½çš„æ˜¯ä¸€ä¸ª<strong>é»˜è®¤æä¾›çš„æ ¸å¿ƒæ¨¡å—</strong>ï¼ˆä½äº Node çš„ç³»ç»Ÿå®‰è£…ç›®å½•ä¸­ï¼‰ï¼Œæˆ–è€…ä¸€ä¸ªä½äºå„çº§ <code>node_modules</code> ç›®å½•çš„å·²å®‰è£…æ¨¡å—ï¼ˆå…¨å±€å®‰è£…æˆ–å±€éƒ¨å®‰è£…ï¼‰ã€‚</p></li></ol><p>ä¸¾ä¾‹æ¥è¯´ï¼Œè„šæœ¬ <code>/home/user/projects/foo.js</code> æ‰§è¡Œäº† <code>require(&#x27;bar.js&#x27;)</code> å‘½ä»¤ï¼ŒNode ä¼šä¾æ¬¡æœç´¢ä»¥ä¸‹æ–‡ä»¶ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># Node å®‰è£…å…¨å±€ä¾èµ–çš„ç›®å½•</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">/usr/local/lib/node/bar.js</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># å½“å‰æ–‡ä»¶å¤¹ä¾èµ–ç›®å½•</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">/home/user/projects/node_modules/bar.js</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># çˆ¶ç›®å½•ä¾èµ–ç›®å½•</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">/home/user/node_modules/bar.js</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># çˆ¶ç›®å½•çš„çˆ¶ç›®å½•ä¾èµ–ç›®å½•</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">/home/node_modules/bar.js</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># æ²¿è·¯å¾„å‘ä¸Šé€çº§é€’å½’ï¼Œç›´åˆ°æ ¹ç›®å½•ä¸‹çš„ä¾èµ–ç›®å½•</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">/node_modules/bar.js</span></div></pre></div><p>è¿™ç§è·¯å¾„çš„ç”Ÿæˆæ–¹å¼ä¸ JavaScript çš„åŸå‹é“¾æˆ–ä½œç”¨åŸŸçš„æŸ¥æ‰¾æ–¹å¼ååˆ†ç±»ä¼¼ã€‚åœ¨åŠ è½½çš„è¿‡ç¨‹ä¸­ï¼ŒNode ä¼šé€ä¸ªå°è¯•æ¨¡å—è·¯å¾„ä¸­çš„è·¯å¾„ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡æ–‡ä»¶ä¸ºæ­¢ã€‚å¯ä»¥çœ‹å‡ºï¼Œå½“å‰æ–‡ä»¶çš„è·¯å¾„è¶Šæ·±ï¼Œæ¨¡å—æŸ¥æ‰¾è€—æ—¶ä¼šè¶Šå¤šï¼Œè¿™æ˜¯è‡ªå®šä¹‰æ¨¡å—çš„åŠ è½½é€Ÿåº¦æ˜¯æœ€æ…¢çš„åŸå› ã€‚</p><ol start="4"><li><p>å¦‚æœå‚æ•°å­—ç¬¦ä¸²ä¸ä»¥ <code>./</code> æˆ– <code>/</code> å¼€å¤´ï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªè·¯å¾„ï¼Œæ¯”å¦‚ <code>require(&#x27;example/path/to/file&#x27;)</code>ï¼Œåˆ™å°†å…ˆæ‰¾åˆ° <code>example</code> çš„ä½ç½®ï¼Œç„¶åå†ä»¥å®ƒä¸ºå‚æ•°ï¼Œæ‰¾åˆ°åç»­è·¯å¾„ã€‚</p></li><li><p>å¦‚æœæŒ‡å®šçš„æ¨¡å—æ–‡ä»¶æ²¡æœ‰å‘ç°ï¼ŒNode ä¼šå°è¯•ä¸ºæ–‡ä»¶åæ·»åŠ  <code>.js</code>ã€<code>.json</code>ã€<code>.node</code> åï¼Œå†å»æœç´¢ã€‚<code>.js</code> ä»¶ä¼šä»¥æ–‡æœ¬æ ¼å¼çš„ JavaScript è„šæœ¬æ–‡ä»¶è§£æï¼Œ<code>.json</code> æ–‡ä»¶ä¼šä»¥ JSON æ ¼å¼çš„æ–‡æœ¬æ–‡ä»¶è§£æï¼Œ<code>.node</code> æ–‡ä»¶ä¼šä»¥ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶è§£æã€‚</p></li><li><p>å¦‚æœæƒ³å¾—åˆ° <code>require</code> å‘½ä»¤åŠ è½½çš„<strong>ç¡®åˆ‡æ–‡ä»¶å</strong>ï¼Œä½¿ç”¨ <code>require.resolve()</code> æ–¹æ³•ã€‚</p></li><li><p>å¦‚æœå‚æ•°å­—ç¬¦ä¸²ä¸ºç›®å½•çš„è·¯å¾„ï¼Œåˆ™è‡ªåŠ¨æŸ¥æ‰¾è¯¥æ–‡ä»¶å¤¹ä¸‹çš„ <code>package.json</code> æ–‡ä»¶ï¼Œç„¶åå†åŠ è½½è¯¥æ–‡ä»¶å½“ä¸­ <code>main</code> å­—æ®µæ‰€æŒ‡å®šçš„å…¥å£æ–‡ä»¶ï¼ˆè‹¥æ²¡æœ‰ <code>package.json</code> æ–‡ä»¶æˆ–è¯¥æ–‡ä»¶ä¸­æ—  <code>main</code> å­—æ®µï¼Œåˆ™é»˜è®¤æŸ¥æ‰¾è¯¥æ–‡ä»¶å¤¹ä¸‹çš„ <code>index.js</code> æ–‡ä»¶ä½œä¸ºæ¨¡å—æ¥è½½å…¥ï¼‰</p></li></ol><p>âš ï¸ <strong>æ³¨æ„</strong>ï¼šNode çš„ç³»ç»Ÿæ¨¡å—çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¸€æ—¦æœ‰ç¬¬ä¸‰æ–¹æ¨¡å—åŒ…ä¸æ ¸å¿ƒæ¨¡å—é‡åï¼Œåˆ™ä»¥ Node å†…ç½®æ ¸å¿ƒæ¨¡å—ä¸ºå‡†ã€‚</p><h3 id="ç›®å½•çš„åŠ è½½è§„åˆ™"><a aria-hidden="true" tabindex="-1" href="/node-guidebook//overview/module/commonjs#ç›®å½•çš„åŠ è½½è§„åˆ™"><span class="icon icon-link"></span></a>ç›®å½•çš„åŠ è½½è§„åˆ™</h3><p>é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šæŠŠç›¸å…³çš„æ–‡ä»¶ä¼šæ”¾åœ¨ä¸€ä¸ªç›®å½•é‡Œé¢ï¼Œä¾¿äºç»„ç»‡ã€‚è¿™æ—¶ï¼Œæœ€å¥½ä¸ºè¯¥ç›®å½•è®¾ç½®ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œè®© <code>require</code> æ–¹æ³•å¯ä»¥é€šè¿‡è¿™ä¸ªå…¥å£æ–‡ä»¶ï¼ŒåŠ è½½æ•´ä¸ªç›®å½•ã€‚</p><p>åœ¨ç›®å½•ä¸­æ”¾ç½®ä¸€ä¸ª <code>package.json</code> æ–‡ä»¶ï¼Œå¹¶ä¸”å°†å…¥å£æ–‡ä»¶å†™å…¥ <code>main</code> å­—æ®µã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-json"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;some-library&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;main&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;./lib/some-library.js&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p><code>require</code> å‘ç°å‚æ•°å­—ç¬¦ä¸²æŒ‡å‘ä¸€ä¸ªç›®å½•ä»¥åï¼Œä¼šè‡ªåŠ¨æŸ¥çœ‹è¯¥ç›®å½•çš„ <code>package.json</code> æ–‡ä»¶ï¼Œç„¶ååŠ è½½ <code>main</code> å­—æ®µæŒ‡å®šçš„å…¥å£æ–‡ä»¶ã€‚å¦‚æœ <code>package.json</code> æ–‡ä»¶æ²¡æœ‰ <code>main</code> å­—æ®µï¼Œæˆ–è€…æ ¹æœ¬å°±æ²¡æœ‰ <code>package.json</code> æ–‡ä»¶ï¼Œåˆ™ä¼šåŠ è½½è¯¥ç›®å½•ä¸‹çš„ <code>index.js</code> æ–‡ä»¶æˆ– <code>index.node</code> æ–‡ä»¶ã€‚</p><blockquote><p>äº‹å®ä¸Šï¼Œä¸åŒçš„æ¨¡å—è§„èŒƒä¼šå‚ç…§ <code>package.json</code> ä¸­çš„ä¸åŒå­—æ®µï¼š</p><ul><li><code>main</code>ï¼šCommonJS æ¨¡å—</li><li><code>module</code>ï¼šES Module æ¨¡å—</li><li><code>unpkg</code>ï¼šæ‰“åŒ…å‹ç¼©æ–‡ä»¶</li><li><code>typings</code>ï¼šTypeScript å®šä¹‰æ–‡ä»¶</li></ul></blockquote><h3 id="æ¨¡å—çš„ç¼“å­˜"><a aria-hidden="true" tabindex="-1" href="/node-guidebook//overview/module/commonjs#æ¨¡å—çš„ç¼“å­˜"><span class="icon icon-link"></span></a>æ¨¡å—çš„ç¼“å­˜</h3><p>ç¬¬ä¸€æ¬¡åŠ è½½æŸä¸ªæ¨¡å—æ—¶ï¼ŒNode ä¼šç¼“å­˜è¯¥æ¨¡å—ã€‚ä»¥åå†åŠ è½½è¯¥æ¨¡å—ï¼Œå°±ç›´æ¥ä»ç¼“å­˜å–å‡ºè¯¥æ¨¡å—çš„ <code>module.exports</code> å±æ€§ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./example.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./example.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./example.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// &quot;hello&quot;</span></div></pre></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œè¿ç»­ä¸‰æ¬¡ä½¿ç”¨ <code>require</code> å‘½ä»¤ï¼ŒåŠ è½½åŒä¸€ä¸ªæ¨¡å—ã€‚ç¬¬äºŒæ¬¡åŠ è½½çš„æ—¶å€™ï¼Œä¸ºè¾“å‡ºçš„å¯¹è±¡æ·»åŠ äº†ä¸€ä¸ª <code>message</code> å±æ€§ã€‚ä½†æ˜¯ç¬¬ä¸‰æ¬¡åŠ è½½çš„æ—¶å€™ï¼Œè¿™ä¸ª <code>message</code> å±æ€§ä¾ç„¶å­˜åœ¨ï¼Œè¿™å°±è¯æ˜ <code>require</code> å‘½ä»¤å¹¶æ²¡æœ‰é‡æ–°åŠ è½½æ¨¡å—æ–‡ä»¶ï¼Œè€Œæ˜¯è¾“å‡ºäº†ç¼“å­˜ã€‚</p><p>ğŸ’¡ <strong>TIPS</strong>ï¼šå¦‚æœæƒ³è¦å¤šæ¬¡æ‰§è¡ŒæŸä¸ªæ¨¡å—ï¼Œå¯ä»¥è®©è¯¥æ¨¡å—è¾“å‡ºä¸€ä¸ª<strong>å‡½æ•°</strong>ï¼Œç„¶åæ¯æ¬¡ <code>require</code> è¿™ä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œé‡æ–°æ‰§è¡Œä¸€ä¸‹è¾“å‡ºçš„å‡½æ•°ã€‚</p><p>æ‰€æœ‰ç¼“å­˜çš„æ¨¡å—ä¿å­˜åœ¨ <code>require.cache</code> ä¹‹ä¸­ï¼Œå¦‚æœæƒ³åˆ é™¤æ¨¡å—çš„ç¼“å­˜ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·å†™ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// åˆ é™¤æŒ‡å®šæ¨¡å—çš„ç¼“å­˜</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">delete</span><span class="token plain"> require</span><span class="token punctuation">.</span><span class="token property-access">cache</span><span class="token punctuation">[</span><span class="token plain">moduleName</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// åˆ é™¤æ‰€æœ‰æ¨¡å—çš„ç¼“å­˜</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span><span class="token plain">require</span><span class="token punctuation">.</span><span class="token property-access">cache</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">delete</span><span class="token plain"> require</span><span class="token punctuation">.</span><span class="token property-access">cache</span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>âš ï¸ <strong>æ³¨æ„</strong>ï¼šç¼“å­˜æ˜¯æ ¹æ® <strong>ç»å¯¹è·¯å¾„</strong> è¯†åˆ«æ¨¡å—çš„ï¼Œå¦‚æœåŒæ ·çš„æ¨¡å—åï¼Œä½†æ˜¯ä¿å­˜åœ¨ä¸åŒçš„è·¯å¾„ï¼Œ<code>require</code> å‘½ä»¤è¿˜æ˜¯ä¼šé‡æ–°åŠ è½½è¯¥æ¨¡å—ã€‚</p><h3 id="å¾ªç¯åŠ è½½"><a aria-hidden="true" tabindex="-1" href="/node-guidebook//overview/module/commonjs#å¾ªç¯åŠ è½½"><span class="icon icon-link"></span></a>å¾ªç¯åŠ è½½</h3><p>å¦‚æœå‘ç”Ÿæ¨¡å—çš„ <strong>å¾ªç¯åŠ è½½</strong>ï¼Œå³ <code>foo</code> åŠ è½½ <code>bar</code>ï¼Œ<code>bar</code> åˆåŠ è½½ <code>foo</code>ï¼Œåˆ™ <code>bar</code> å°†åŠ è½½ <code>foo</code> çš„ <strong>ä¸å®Œæ•´ç‰ˆæœ¬</strong>ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// foo.js</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;foo start&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token property-access">done</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> bar </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./bar&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;åœ¨ foo ä¸­ï¼Œbar.done = %j&#x27;</span><span class="token punctuation">,</span><span class="token plain"> bar</span><span class="token punctuation">.</span><span class="token property-access">done</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token property-access">done</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;foo end&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// bar.js</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;bar start&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token property-access">done</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> foo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./foo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;åœ¨ bar ä¸­ï¼Œfoo.done = %j&#x27;</span><span class="token punctuation">,</span><span class="token plain"> foo</span><span class="token punctuation">.</span><span class="token property-access">done</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token property-access">done</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;bar end&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// main.js</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;main start&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> foo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./foo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> bar </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./bar&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;åœ¨ main ä¸­ï¼Œfoo.done=%jï¼Œbar.done=%j&#x27;</span><span class="token punctuation">,</span><span class="token plain"> foo</span><span class="token punctuation">.</span><span class="token property-access">done</span><span class="token punctuation">,</span><span class="token plain"> bar</span><span class="token punctuation">.</span><span class="token property-access">done</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>å½“ <code>main.js</code> åŠ è½½ <code>foo.js</code> æ—¶ï¼Œ<code>foo.js</code> åˆåŠ è½½ <code>bar.js</code>ã€‚ æ­¤æ—¶ï¼Œ<code>bar.js</code> ä¼šå°è¯•å»åŠ è½½ <code>foo.js</code>ã€‚ ä¸ºäº†é˜²æ­¢æ— é™çš„å¾ªç¯ï¼Œä¼šè¿”å›ä¸€ä¸ª <code>foo.js</code> çš„ <code>exports</code> å¯¹è±¡çš„æœªå®Œæˆçš„å‰¯æœ¬ç»™ <code>bar.js</code> æ¨¡å—ã€‚ ç„¶å <code>bar.js</code> å®ŒæˆåŠ è½½ï¼Œå¹¶å°† <code>exports</code> å¯¹è±¡æä¾›ç»™ <code>foo.js</code> æ¨¡å—ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># æ‰§è¡Œä¸»æ–‡ä»¶</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ </span><span class="token function">node</span><span class="token plain"> main.js</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">main start</span></div><div class="token-line"><span class="token plain">foo start</span></div><div class="token-line"><span class="token plain">bar start</span></div><div class="token-line"><span class="token plain">åœ¨ bar ä¸­ï¼Œa.done </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">bar ç»“æŸ</span></div><div class="token-line"><span class="token plain">åœ¨ foo ä¸­ï¼Œb.done </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">foo ç»“æŸ</span></div><div class="token-line"><span class="token plain">åœ¨ main ä¸­ï¼Œa.done</span><span class="token operator">=</span><span class="token plain">trueï¼Œb.done</span><span class="token operator">=</span><span class="token plain">true</span></div></pre></div><h3 id="requiremain"><a aria-hidden="true" tabindex="-1" href="/node-guidebook//overview/module/commonjs#requiremain"><span class="icon icon-link"></span></a>require.main</h3><p><code>require</code> æ–¹æ³•æœ‰ä¸€ä¸ª <code>main</code> å±æ€§ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­æ¨¡å—æ˜¯ç›´æ¥æ‰§è¡Œï¼Œè¿˜æ˜¯è¢«è°ƒç”¨æ‰§è¡Œã€‚</p><ul><li>ç›´æ¥æ‰§è¡Œçš„æ—¶å€™ï¼ˆ<code>node module.js</code>ï¼‰ï¼Œ<code>require.main</code> å±æ€§æŒ‡å‘æ¨¡å—æœ¬èº«ã€‚</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">require</span><span class="token punctuation">.</span><span class="token property-access">main</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> module</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// true</span></div></pre></div><ul><li>è°ƒç”¨æ‰§è¡Œçš„æ—¶å€™ï¼ˆé€šè¿‡ <code>require</code> åŠ è½½è¯¥è„šæœ¬æ‰§è¡Œï¼‰ï¼Œä¸Šé¢çš„è¡¨è¾¾å¼è¿”å› <code>false</code>ã€‚</li></ul><h3 id="requireresolve"><a aria-hidden="true" tabindex="-1" href="/node-guidebook//overview/module/commonjs#requireresolve"><span class="icon icon-link"></span></a>require.resolve</h3><p><code>require.resolve</code> ç”¨äºè·å–æ¨¡å—çš„ç»å¯¹è·¯å¾„ï¼Œè¯¥æ–¹æ³•çš„æ‰§è¡Œå¹¶ä¸ä¼šçœŸæ­£åœ°åŠ è½½è¯¥æ¨¡å—ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// å·²å®‰è£… React è‡³ node_modules</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> react </span><span class="token operator">=</span><span class="token plain"> require</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;react&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">react</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// /Users/mrsingsing/Desktop/demo/node_modules/react/index.js</span></div></pre></div><hr/><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li><a target="_blank" rel="noopener noreferrer" href="http://wiki.commonjs.org/wiki/CommonJS">ğŸ“– Wikiï¼šCommonJS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.im/post/6844903809957756936">ğŸ“ Node.js ä¸­çš„ require å‡½æ•°<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook/edit/master/docs/overview/module/commonjs.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last update: ">2/21/2022 13:48:52</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/node-guidebook/umi.js"></script>
  </body>
</html>
